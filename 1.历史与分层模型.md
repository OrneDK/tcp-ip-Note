# TCP/IP协议

## TCP/IP的历史背景
1969年由ARPA建立ARPANET,现代计算机网路很多理念都来自ARPANET。1983年TCP/IP协议成为APRANET的标准协议,所有使用TCP/IP协议的计算机都能互联。因此，人们把1983年当做互联网诞生的元年。

## TCP/IP协议的分层模型
![avatar](/img/1.jpg)
可以以一种U型结构来理解HTTP,当客户端以TCP/IP协议向服务器发送通信时,以左侧用户端开始包装包信息,以物理层传输到服务器后,以一种倒推的方式层层解包。最终获得用户传输的数据内容。
- 网络接口层
- 网络互联层
- 传输层
- 应用层
  应用层规定了应用间以什么格式传递报文；以HTTP为例,它规定了
  - 文本类型(请求/响应)
  - 报文语法(报文为几段，各段含义，以什么分隔，每部分字段的含义)
  - 进程以什么样的时序发送报文/处理响应报文
  HTTP的应用层协议以RFC文档定义 [相关链接](https://tools.ietf.org/html/rfc2616).   
  HTTP报文格式由三部分组成：
  - 起始行(start line),起始行根据是请求报文还是响应报文分为[请求行]和[响应行]。这个例子中起始行是 $\color{red}{ GET / HTTP/1.1 }$,
  - 头部(header),头部采用key:value形式记录,每行以空行符分隔
  - 实体(entity),可选填,实体内容为HTTP真正要传输的内容，html字符串或静态文件等内容。
  ![avatar](/img/2.png)
- 传输层(Transport Layer)
  传输层的作用为两台主机之间[应用进程]提供端到端的逻辑通信，对[传输行为进行控制],TCP协议被称为传输控制协议(Transmission Control Protocol),为下面两层协议提供数据包重传、流量控制、拥塞控制等。   
  传输层用端口号来标识不同的应用程序，主机收到数据包以后根据目标端口号将数据包传递给对应应用程序进行处理(如果使用了nginx则交由nginx处理)。
- 网络互联层(Internet Layer)
  网络互联层提供主机到主机的通信,将传输层产生数据包封装成分组数据包发送到目标主机,并提供路由选择的能力。`IP协议是网络层的主要协议，TCP和UDP都是用IP协议作为网络层协议。`这一层的主要作用是给包加上源地址和目标地址，将数据包传送到目标地址。IP协议是一个无连接协议，也不具备重发机制，这也就是TCP协议复杂的原因之一。
- 网络访问层(Network Access layer)
  网络访问层(也有叫网络接口层,以太网、Wifi、蓝牙工作再这一层，网络访问层提供主机连接到物理网络)。
### 分层的好处
分层的本质是通过分离关注点，让复杂问题简单化，分层的好处：
- 各层独立：限制依赖关系范围，各层之间使用标准化接口，各层不需要知道上下层是如何工作的，增加、修改应用层协议不会影响传输层协议。
- 灵活性更好：各层只需要加载自己层级需要的协议层即可。
- 易于测试维护：可以独立测试特定层级。
- 促进标准化：每一层职责清楚，方便进行标准化。


## Q&A 收到IP数据包解析后，它怎么知道这个分组应该投递到上层的哪一个协议(UDP或TCP)?
在互联层中包含protocol属性,定义了此次使用的协议(TCP(6/4) 或 UDP)
  ![avatar](/img/3.png)