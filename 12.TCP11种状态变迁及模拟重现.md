# TCP的十一种状态
在此处要先定义好，由于TCP的双工的协议，并无客户端、服务端之分。我们目前在前方先定义两个概念：主动请求方一般指客户端，被动等待端一般指服务端。方便概念的理解。

## 客户端

### 1.CLOSED
这种状态只是一种描述状态，描述的是TCP链接还未开始建立连接或者已经彻底释放的状态。在真实场景中对应的是双方互相不连接的状态。它的状态转换有两种：
- 主动打开(Active Open) 主动访问请求(客户端请求)。
- 被动打开(Passive Open) 等待客户端的新连接状态(服务端暴露端口等待访问)。


### 2.SYN-SENT
当客户端发送SYN报文后，等待服务端返回ACK的过程被称之为SYN-SENT状态。在此状态中当发送SYN后会同步启动一个定时器，如果超时后还未收到ACK会重发SYN。

### 3.ESTABLISHED
当接收到服务端传来的SYN+ACK值后，客户端会继续返回一个ACK值，如果服务端接收成功后，双方将都会进入ESTABLISHED状态，表示连接建立成功。

### 4.CLOSE-WAIT
当客户端收到FIN-WAIT-2状态下的FIN包进入CLOSE-WAIT状态。


#### 5.LAST-ACK
当收到服务端的FIN包后，发送FIN包给服务端确认,等待客户端发送最后的ACK确认包时的状态。

## 服务端

### 1.LISTEN
服务端调用bind、listen系统调用监听特定端口时进入到LISTEN状态，等待客户端发送SYN报文三次握手建立连接。

### 2.SYN-RCVD
服务端收到SYN报文会回复SYN+ACK，等待客户端ACK的时候进入SYN-RCVD状态。

### 3.FIN-WAIT-1
如果客户端长时间没有发送请求，服务端将会尝试发送FIN包,等待客户端回复ACK时进入FIN-WAIT-1状态。(客户端也可以主动发送FIN包结束此次会话,此处只是为了方便叙述与理解)

### 4.FIN-WAIT-2
处于FIN-WAIT-1状态的连接收到ACK确认包以后进入FIN-WAIT-2状态，这个时候服务端的FIN包已经被对方确认，等待客户端发送FIN包，收到后，进入TIME-WAIT状态。

### 5.TIME-WAIT
收到被动关闭方的FIN包 后，发送确认ACK给客户端，开启2MSL定时器，定时器到期进入CLOSED状态，释放连接。



## 特殊状态

### CLOSING状态
同时关闭的情况，全双工协议下，当发起方发送FIN还未收到确认包的情况下。对方也发送了FIN请求断开连接时，将进入CLOSING状态，进入CLOSING状态后将会向对方发送ACK包来完成最后的CLOSED状态，最后完成关闭连接。